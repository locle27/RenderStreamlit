{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
    <h1 class="mb-4">üìä T·ªïng quan Dashboard</h1>
    
    <!-- H√†ng ch·ª©a c√°c Card s·ªë li·ªáu -->
    <div class="row">
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card text-white bg-primary h-100">
                <div class="card-header">T·ªïng ƒê·∫∑t Ph√≤ng</div>
                <div class="card-body">
                    <h4 class="card-title">{{ total_bookings }}</h4>
                    <p class="card-text">{{ active_bookings }} ƒëang ho·∫°t ƒë·ªông.</p>
                </div>
            </div>
        </div>
        <!-- B·∫°n c√≥ th·ªÉ th√™m c√°c card s·ªë li·ªáu kh√°c ·ªü ƒë√¢y n·∫øu c·∫ßn -->
    </div>

    <hr class="my-4">

    <!-- H√†ng ch·ª©a c√°c Bi·ªÉu ƒë·ªì -->
    <div class="row">
        <div class="col-lg-12 mb-4">
            <div class="card">
                <div class="card-body">
                    <div id="monthly_revenue_chart_div" data-chart='{{ monthly_revenue_chart | safe }}'></div>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-body">
                    <div id="room_revenue_chart_div" data-chart='{{ room_revenue_chart | safe }}'></div>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-body">
                    <div id="collector_revenue_chart_div" data-chart='{{ collector_revenue_chart | safe }}'></div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function renderPlotlyChart(divId) {
                const chartDiv = document.getElementById(divId);
                if (chartDiv && chartDiv.dataset.chart) {
                    try {
                        const chartData = JSON.parse(chartDiv.dataset.chart);
                        const config = {responsive: true};
                        Plotly.newPlot(divId, chartData.data, chartData.layout, config);
                    } catch (e) {
                        console.error('L·ªói khi v·∫Ω bi·ªÉu ƒë·ªì cho ' + divId, e);
                        chartDiv.innerHTML = '<p class="text-danger">Kh√¥ng th·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì.</p>';
                    }
                }
            }

            renderPlotlyChart('monthly_revenue_chart_div');
            renderPlotlyChart('room_revenue_chart_div');
            renderPlotlyChart('collector_revenue_chart_div');
        });
    </script>
{% endblock %}